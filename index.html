<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无限暖暖颜色转换器</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #fef6f9;
            padding: 20px;
        }
        
        .page-title {
            text-align: center;
            color: #ff69b4;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 1px 1px 3px rgba(255, 105, 180, 0.3);
            font-weight: bold;
        }
        
        .color-picker-container {
            display: flex;
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.2);
            max-width: 600px;
            width: 100%;
            flex-direction: column; /* 改为垂直排列 */
            align-items: center;
        }
        
        .color-wheel {
            position: relative;
            width: 256px;
            height: 256px;
            margin-right: 20px;
        }
        
        .color-wheel-canvas {
            border-radius: 50%;
            border: 2px solid #ffc0cb;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.1);
        }
        
        .color-wheel-thumb {
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: white;
            border: 2px solid #ff69b4;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        
        .value-slider {
            width: 30px;
            height: 256px;
            position: relative;
            margin-right: 20px;
        }
        
        .value-slider-canvas {
            border: 2px solid #ffc0cb;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.1);
        }
        
        .value-slider-thumb {
            position: absolute;
            width: 34px;
            height: 5px;
            background-color: transparent;
            border: 2px solid white;
            box-sizing: border-box;
            left: -2px;
            transform: translateY(-50%);
            pointer-events: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex: 1;
            min-width: 0; /* 允许在必要时收缩到小于内容宽度 */
            max-width: calc(100% - 306px); /* 256px(色轮宽度) + 30px(亮度滑块宽度) + 20px*2(边距) */
            overflow: hidden; /* 防止内容溢出 */
        }
        
        .color-values {
            display: grid;
            grid-template-columns: auto auto;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .color-value-group {
            display: flex;
            align-items: center;
        }
        
        .color-value-group label {
            width: 20px;
            font-weight: bold;
            margin-right: 5px;
            color: #ff69b4;
        }
        
        .color-value-group input {
            width: 100%;
            max-width: 70px;
            box-sizing: border-box;
        }
        
        .color-value-group input:focus {
            border-color: #ff69b4;
            box-shadow: 0 0 5px rgba(255, 105, 180, 0.3);
        }
        
        .color-preview {
            width: 100%;
            height: 70px;
            border: 2px solid #ffc0cb;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 0 10px rgba(255, 105, 180, 0.1);
        }
        
        .hex-value {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            width: 100%;
        }

        .import-button {
            height: 34px; /* 与输入框高度匹配 */
            padding: 0 12px;
            margin-left: 10px;
            background-color: #ff69b4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
            box-sizing: border-box;
            font-size: 14px; /* 添加合适的字体大小 */
            line-height: 1; /* 修正行高 */
            display: flex; /* 使用flexbox实现更好的对齐 */
            align-items: center; /* 垂直居中文本 */
            justify-content: center; /* 水平居中文本 */
            white-space: nowrap; /* 防止文本换行 */
        }


        .import-button:hover {
            background-color: #ff5ba7;
        }

        .color-picker-content {
            display: flex;
            width: 100%;
            margin-bottom: 15px;
        }

        .color-info {
            width: 100%;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 15px;
        }

        .info-box {
            flex: 1;
            padding: 12px 15px;
            background-color: #fff;
            border: 1px solid #ffc0cb;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .info-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(255, 105, 180, 0.2);
            background-color: #fff9fb;
        }
        .info-box:active {
            transform: translateY(-1px);
        }

        .info-title {
            font-size: 14px;
            color: #ff69b4;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 600;
        }

        /* 复制成功提示 */
        .copy-tooltip {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 105, 180, 0.9);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 500;
            font-size: 14px;
            opacity: 0;
            transform: translateY(100%);
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .info-box.copied .copy-tooltip {
            opacity: 1;
            transform: translateY(0);
        }

        
        .hex-value label {
            font-weight: bold;
            margin-right: 10px;
            color: #ff69b4;
        }
        
        .hex-value input {
            flex-grow: 1;
            flex: 1;
            padding: 8px;
            border: 1px solid #ffc0cb;
            border-radius: 5px;
            outline: none;
            min-width: 0; /* 允许输入框在必要时收缩 */
        }
        
        .hex-value input:focus {
            border-color: #ff69b4;
            box-shadow: 0 0 5px rgba(255, 105, 180, 0.3);
        }
        
        @media (max-width: 768px) {
            .color-picker-container {
                flex-direction: column;
                align-items: center;
                padding: 15px;
            }
            
            .color-wheel, .value-slider {
                margin-right: 0;
                margin-bottom: 20px;
            }
            
            .controls {
                width: 100%;
            }

            .color-info {
                flex-direction: column;
            }
            
            .info-box {
                margin-bottom: 8px;
            }

        }
    </style>
</head>
<body>
    <h1 class="page-title">无限暖暖颜色转换器</h1>
    <div class="color-picker-container">
        <div class="color-picker-content">

            <div class="color-wheel">
                <canvas id="colorWheel" class="color-wheel-canvas" width="256" height="256"></canvas>
                <div class="color-wheel-thumb" id="colorWheelThumb"></div>
            </div>
            
            <div class="value-slider">
                <canvas id="valueSlider" class="value-slider-canvas" width="30" height="256"></canvas>
                <div class="value-slider-thumb" id="valueSliderThumb"></div>
            </div>
            
            <div class="controls">
                <div class="color-values">
                    <div class="color-value-group">
                        <label for="hue">H</label>
                        <input type="number" id="hue" min="0" max="360" step="1" value="0">
                    </div>
                    <div class="color-value-group">
                        <label for="red">R</label>
                        <input type="number" id="red" min="0" max="255" step="1" value="255">
                    </div>
                    <div class="color-value-group">
                        <label for="saturation">S</label>
                        <input type="number" id="saturation" min="0" max="100" step="1" value="100">
                    </div>
                    <div class="color-value-group">
                        <label for="green">G</label>
                        <input type="number" id="green" min="0" max="255" step="1" value="0">
                    </div>
                    <div class="color-value-group">
                        <label for="value">V</label>
                        <input type="number" id="value" min="0" max="100" step="1" value="100">
                    </div>
                    <div class="color-value-group">
                        <label for="blue">B</label>
                        <input type="number" id="blue" min="0" max="255" step="1" value="0">
                    </div>
                </div>
                
                <div class="color-preview" id="colorPreview"></div>
                
                <div class="hex-value">
                    <label for="hex">HEX</label>
                    <input type="text" id="hex" value="#FF0000">
                    <button id="importHex" class="import-button">导入</button>
                </div>
            </div>
        </div>
        <!-- 信息显示区域放在下方 -->
        <div class="color-info">
            <div class="info-box" id="rgbInfo" data-copy-value="255,0,0">
                <div class="info-title">RGB</div>
                <div class="info-value">255, 0, 0</div>
            </div>
            <div class="info-box" id="hexInfo" data-copy-value="#FF0000">
                <div class="info-title">HEX</div>
                <div class="info-value">#FF0000</div>
            </div>
            <div class="info-box" id="hsvInfo" data-copy-value="0°, 100%, 100%">
                <div class="info-title">HSV</div>
                <div class="info-value">0°, 100%, 100%</div>
            </div>
        </div>
    </div>

    <script>
        // DOM 元素
        const colorWheel = document.getElementById('colorWheel');
        const colorWheelThumb = document.getElementById('colorWheelThumb');
        const valueSlider = document.getElementById('valueSlider');
        const valueSliderThumb = document.getElementById('valueSliderThumb');
        const colorPreview = document.getElementById('colorPreview');
        const hueInput = document.getElementById('hue');
        const saturationInput = document.getElementById('saturation');
        const valueInput = document.getElementById('value');
        const redInput = document.getElementById('red');
        const greenInput = document.getElementById('green');
        const blueInput = document.getElementById('blue');
        const hexInput = document.getElementById('hex');
        const importHexButton = document.getElementById('importHex');
        const rgbInfo = document.getElementById('rgbInfo');
        const hexInfo = document.getElementById('hexInfo');
        const hsvInfo = document.getElementById('hsvInfo');


        // 当前 HSV 值
        let hsv = { h: 0, s: 100, v: 100 };
        let updating = false;

        // 初始化色轮
        const colorWheelCtx = colorWheel.getContext('2d');
        drawColorWheel();

        // 初始化亮度滑块
        const valueSliderCtx = valueSlider.getContext('2d');
        drawValueSlider();

        // 用初始颜色更新所有显示
        updateColor();

        // 色轮的事件监听器
        colorWheel.addEventListener('mousedown', startColorWheelDrag);
        valueSlider.addEventListener('mousedown', startValueSliderDrag);

        // 输入框的事件监听器
        hueInput.addEventListener('input', updateFromHSV);
        saturationInput.addEventListener('input', updateFromHSV);
        valueInput.addEventListener('input', updateFromHSV);
        redInput.addEventListener('input', updateFromRGB);
        greenInput.addEventListener('input', updateFromRGB);
        blueInput.addEventListener('input', updateFromRGB);

        // 绘制色轮
        function drawColorWheel() {
            const centerX = colorWheel.width / 2;
            const centerY = colorWheel.height / 2;
            const radius = Math.min(centerX, centerY);

            // 清空画布
            colorWheelCtx.clearRect(0, 0, colorWheel.width, colorWheel.height);

            // 绘制色轮
            for (let angle = 0; angle < 360; angle += 1) {
                const startAngle = (angle - 0.5) * Math.PI / 180;
                const endAngle = (angle + 0.5) * Math.PI / 180;

                colorWheelCtx.beginPath();
                colorWheelCtx.moveTo(centerX, centerY);
                colorWheelCtx.arc(centerX, centerY, radius, startAngle, endAngle);
                colorWheelCtx.closePath();

                // 创建饱和度渐变
                const gradient = colorWheelCtx.createRadialGradient(
                    centerX, centerY, 0, 
                    centerX, centerY, radius
                );
                gradient.addColorStop(0, 'white');
                
                // 将角度垂直翻转 (沿水平轴对称)
                const flippedAngle = (360 - angle) % 360;
                gradient.addColorStop(1, `hsl(${flippedAngle}, 100%, 50%)`);

                colorWheelCtx.fillStyle = gradient;
                colorWheelCtx.fill();
            }
        }


        // 根据当前色调和饱和度绘制亮度滑块
        function drawValueSlider() {
            const width = valueSlider.width;
            const height = valueSlider.height;
            const gradient = valueSliderCtx.createLinearGradient(0, 0, 0, height);
            
            const rgbTop = hsvToRgb(hsv.h, hsv.s / 100, 1);
            const hexTop = rgbToHex(rgbTop.r, rgbTop.g, rgbTop.b);
            
            gradient.addColorStop(0, hexTop);
            gradient.addColorStop(1, '#000000');
            
            valueSliderCtx.fillStyle = gradient;
            valueSliderCtx.fillRect(0, 0, width, height);
        }

        // 开始拖动色轮指示器
        function startColorWheelDrag(e) {
            document.addEventListener('mousemove', dragColorWheel);
            document.addEventListener('mouseup', stopDrag);
            dragColorWheel(e);
        }

        // 拖动色轮指示器
        function dragColorWheel(e) {
            const rect = colorWheel.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            
            const x = e.clientX - rect.left - centerX;
            const y = e.clientY - rect.top - centerY;
            
            const radius = Math.min(centerX, centerY);
            const distance = Math.sqrt(x * x + y * y);
            const saturation = Math.min(distance / radius * 100, 100);
            
            // 计算色调角度
            // 把鼠标坐标转换为极坐标中的角度
            let hue = Math.atan2(-y, x) * 180 / Math.PI;
            if (hue < 0) hue += 360;
            
            hsv.h = hue;
            hsv.s = saturation;
            
            updateColor();
        }

        // 开始拖动亮度滑块指示器
        function startValueSliderDrag(e) {
            document.addEventListener('mousemove', dragValueSlider);
            document.addEventListener('mouseup', stopDrag);
            dragValueSlider(e);
        }

        // 拖动亮度滑块指示器
        function dragValueSlider(e) {
            const rect = valueSlider.getBoundingClientRect();
            const y = e.clientY - rect.top;
            const height = rect.height;
            
            const value = 100 - Math.max(0, Math.min(100, (y / height) * 100));
            hsv.v = value;
            
            updateColor();
        }

        // 停止拖动
        function stopDrag() {
            document.removeEventListener('mousemove', dragColorWheel);
            document.removeEventListener('mousemove', dragValueSlider);
            document.removeEventListener('mouseup', stopDrag);
        }

        // 从 HSV 输入更新颜色
        function updateFromHSV() {
            if (updating) return;
            
            // 获取并限制 HSV 范围
            hsv.h = Math.min(360, Math.max(0, parseFloat(hueInput.value) || 0));
            hsv.s = Math.min(100, Math.max(0, parseFloat(saturationInput.value) || 0));
            hsv.v = Math.min(100, Math.max(0, parseFloat(valueInput.value) || 0));
            
            // 强制将输入框的值设为限制后的有效值
            hueInput.value = Math.round(hsv.h);
            saturationInput.value = Math.round(hsv.s);
            valueInput.value = Math.round(hsv.v);
            
            updateColor();
        }

        // 从 RGB 输入更新颜色
        function updateFromRGB() {
            if (updating) return;
            
            // 获取并限制 RGB 范围
            const r = Math.min(255, Math.max(0, parseInt(redInput.value) || 0));
            const g = Math.min(255, Math.max(0, parseInt(greenInput.value) || 0));
            const b = Math.min(255, Math.max(0, parseInt(blueInput.value) || 0));
            
            // 强制将输入框的值设为限制后的有效值
            redInput.value = Math.round(r);
            greenInput.value = Math.round(g);
            blueInput.value = Math.round(b);
            
            const newHsv = rgbToHsv(r, g, b);
            hsv.h = newHsv.h;
            hsv.s = newHsv.s * 100;
            hsv.v = newHsv.v * 100;
            
            updateColor();
        }

        function updateColor(updateHexInput = false) {
            updating = true;
            
            // 更新HSV输入
            hueInput.value = Math.round(hsv.h);
            saturationInput.value = Math.round(hsv.s);
            valueInput.value = Math.round(hsv.v);
            
            // 计算RGB值
            const rgb = hsvToRgb(hsv.h, hsv.s / 100, hsv.v / 100);
            
            // 更新RGB输入
            redInput.value = Math.round(rgb.r);
            greenInput.value = Math.round(rgb.g);
            blueInput.value = Math.round(rgb.b);
            
            // 生成HEX值
            const hexValue = rgbToHex(rgb.r, rgb.g, rgb.b);
            hexInput.value = hexValue;
            
            // 更新颜色预览
            colorPreview.style.backgroundColor = hexValue;
            
            // 更新信息框 - 修改为适应新结构
            const rgbText = `${Math.round(rgb.r)}, ${Math.round(rgb.g)}, ${Math.round(rgb.b)}`;
            const hsvText = `${Math.round(hsv.h)}°, ${Math.round(hsv.s)}%, ${Math.round(hsv.v)}%`;
            
            document.querySelector('#rgbInfo .info-value').textContent = rgbText;
            document.querySelector('#rgbInfo').setAttribute('data-copy-value', rgbText);
            
            document.querySelector('#hexInfo .info-value').textContent = hexValue;
            document.querySelector('#hexInfo').setAttribute('data-copy-value', hexValue);
            
            document.querySelector('#hsvInfo .info-value').textContent = hsvText;
            document.querySelector('#hsvInfo').setAttribute('data-copy-value', hsvText);
            
            // 更新亮度滑块
            drawValueSlider();
            
            // 更新色轮指示器位置
            const radius = colorWheel.width / 2;
            const satRadius = (hsv.s / 100) * radius;
            const angle = hsv.h * Math.PI / 180;
            
            const thumbX = radius + satRadius * Math.cos(angle);
            const thumbY = radius - satRadius * Math.sin(angle);
            
            colorWheelThumb.style.left = `${thumbX}px`;
            colorWheelThumb.style.top = `${thumbY}px`;
            
            // 更新亮度滑块指示器位置
            const valuePos = (100 - hsv.v) / 100 * valueSlider.height;
            valueSliderThumb.style.top = `${valuePos}px`;
            
            updating = false;
        }        // 添加导入按钮事件处理
        importHexButton.addEventListener('click', function() {
            let hex = hexInput.value.trim();
            
            // 检查是否是有效的HEX颜色值
            // 确保以#开头
            if (!hex.startsWith('#')) {
                hex = '#' + hex;
            }
            
            // 验证格式
            if (!/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(hex)) {
                // 无效的HEX值，重置为当前颜色
                const rgb = hsvToRgb(hsv.h, hsv.s / 100, hsv.v / 100);
                hexInput.value = rgbToHex(rgb.r, rgb.g, rgb.b);
                return;
            }
            
            // 将3位HEX扩展为6位
            if (hex.length === 4) {
                const r = hex.charAt(1);
                const g = hex.charAt(2);
                const b = hex.charAt(3);
                hex = `#${r}${r}${g}${g}${b}${b}`;
            }
            
            // 解析为RGB
            const r = parseInt(hex.substring(1, 3), 16);
            const g = parseInt(hex.substring(3, 5), 16);
            const b = parseInt(hex.substring(5, 7), 16);
            
            // 更新输入框值
            redInput.value = r;
            greenInput.value = g;
            blueInput.value = b;
            
            // 转换为HSV并更新颜色
            const newHsv = rgbToHsv(r, g, b);
            hsv.h = newHsv.h;
            hsv.s = newHsv.s * 100;
            hsv.v = newHsv.v * 100;
            
            // 更新显示，并标记更新HEX输入框
            updateColor();
        });
        // 将 HSV 转换为 RGB
        function hsvToRgb(h, s, v) {
            h = (h % 360) / 60;
            const i = Math.floor(h);
            const f = h - i;
            const p = v * (1 - s);
            const q = v * (1 - s * f);
            const t = v * (1 - s * (1 - f));
            
            let r, g, b;
            switch (i) {
                case 0: r = v; g = t; b = p; break;
                case 1: r = q; g = v; b = p; break;
                case 2: r = p; g = v; b = t; break;
                case 3: r = p; g = q; b = v; break;
                case 4: r = t; g = p; b = v; break;
                case 5: r = v; g = p; b = q; break;
            }
            
            return {
                r: r * 255,
                g: g * 255,
                b: b * 255
            };
        }

        // 将 RGB 转换为 HSV
        function rgbToHsv(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const d = max - min;
            
            let h;
            const s = max === 0 ? 0 : d / max;
            const v = max;
            
            if (max === min) {
                h = 0;
            } else {
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h *= 60;
            }
            
            return { h, s, v };
        }

        // 将 RGB 转换为 HEX
        function rgbToHex(r, g, b) {
            r = Math.round(r);
            g = Math.round(g);
            b = Math.round(b);
            
            function componentToHex(c) {
                const hex = c.toString(16).toUpperCase();
                return hex.length === 1 ? '0' + hex : hex;
            }
            
            return `#${componentToHex(r)}${componentToHex(g)}${componentToHex(b)}`;
        }

        const infoBoxes = document.querySelectorAll('.info-box');

        infoBoxes.forEach(box => {
            // 为每个盒子添加复制提示元素
            const tooltip = document.createElement('div');
            tooltip.className = 'copy-tooltip';
            tooltip.textContent = '已复制!';
            box.appendChild(tooltip);
            
            box.addEventListener('click', async function() {
                const textToCopy = this.getAttribute('data-copy-value');
                
                try {
                    // 复制到剪贴板
                    await navigator.clipboard.writeText(textToCopy);
                    
                    // 显示复制成功提示
                    this.classList.add('copied');
                    
                    // 2秒后移除提示
                    setTimeout(() => {
                        this.classList.remove('copied');
                    }, 500);
                } catch (err) {
                    console.error('复制失败:', err);
                }
            });
        });
    </script>
</body>
</html>
